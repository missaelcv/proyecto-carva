<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Probando Canvas</title>
    <style>
        canvas {
            border: 1px solid gray;
            margin: auto;
            display: block;
        }
        img {
            display: none;
        }
    </style>
</head>


<body>
    <canvas id="miCanvas" width="1000" height="500"></canvas>

    <img src="imagenes/gato1.png" alt="" id="gato1">
    <img src="imagenes/gato2.png" alt="" id="gato2">
    <img src="imagenes/gato3.png" alt="" id="gato3">
    <img src="imagenes/gato4.png" alt="" id="gato4">
    <img src="imagenes/gato5.png" alt="" id="gato5">
    <img src="imagenes/gato6.png" alt="" id="gato6">
    <img src="imagenes/gato7.png" alt="" id="gato7">
    <img src="imagenes/gato8.png" alt="" id="gato8">
    
    <script>

        var PropCanvas = {
            intervalo: undefined,
            estaPausado: false,
            posicionHorizontal: undefined,
        };

        let miCanvas = document.getElementById("miCanvas");
        let contexto = miCanvas.getContext("2d");
        let anchura = miCanvas.width;
        let altura = miCanvas.height;
       
        let estaSubiendo = false;
        let estaSaltando = false;
        let maximoASaltar = 700;
        let cantidadASaltar = 0;
        let sonido = 0;
     
        let personaje = {
            x: 0,
            y: 0,
            anchura: 0,
            altura: 0,
            chocaCon(obstaculo) {

               
                let izquierdaPersonaje = this.x;
                let derechaPersonaje = izquierdaPersonaje + this.anchura;
                let arribaPersonaje = this.y;
                let abajoPersonaje = arribaPersonaje + this.altura;

                let izquierdaObstaculo = obstaculo.x;
                let derechaObstaculo = izquierdaObstaculo + obstaculo.anchura;
                let arribaObstaculo = obstaculo.y;
                let abajoObstaculo = arribaObstaculo + obstaculo.altura;

                if (izquierdaPersonaje >= derechaObstaculo || arribaPersonaje >= abajoObstaculo || derechaPersonaje <= izquierdaObstaculo || abajoPersonaje <= arribaObstaculo) {
                    return false;
                }
                else {
                    return true;
                }
            }
        };

        function dibujarObstaculo(tipoObstaculo) {

        }

        let obstaculos = [
        ]; 

        let obstaculoTamano = 0;
        for (let i = 0, x = anchura; i < 50; i++, x += Math.round(Math.random() * 400) + 600) {
            obstaculoTamano = Math.floor(Math.random() * 30) + 100;
            obstaculos.push({
                x: x, y: altura - obstaculoTamano, anchura: 70, altura: obstaculoTamano,
                dibujar(contexto) {
                    contexto.fillStyle = "rgb(150, 0, 0)";
                    contexto.beginPath();
                    contexto.fillRect(this.x, this.y, this.anchura, this.altura);

                    contexto.fillStyle = "black";
                    contexto.beginPath();
                    contexto.fillText(i, this.x + 10, this.y);
                    contexto.fill();
                }
            });
        }

        function gradosARadianes(grados) {
            return grados * (Math.PI / 180);
        }

        //1 - Dibujar Cuadricula
        function dibujarCuadricula(variacion = 20) {
            for (let x = variacion; x < anchura; x += variacion) {
                crearLinea({ x, y: 0 }, { x, y: altura }).dibujar();
            }

            for (let y = variacion; y < altura; y += variacion) {
                crearLinea({ x: 0, y }, { x: anchura, y }).dibujar();
            }
        }
        //4- Dibujar una imagen

        let imagenActual = 1,
            anchuraImagenInicial,
            alturaImagenInicial,
            estaCreciendo = false,
            contidadASaltar = 0;

        personaje.imagen = document.getElementById(`gato${imagenActual}`);

        personaje.anchura = personaje.imagen.width;
        personaje.altura = personaje.imagen.height;

        personaje.imagen.onload = dibujarImagen;

        function dibujarImagen() {
            anchuraImagenInicial = anchuraImagenInicial || personaje.imagen.width;
            alturaImagenInicial = alturaImagenInicial || personaje.imagen.height;
            personaje.anchura = anchuraImagenInicial / 4;//personaje.anchura || anchuraImagenInicial; 
            personaje.altura = alturaImagenInicial / 2; //personaje.altura || alturaImagenInicial;
            personaje.y = altura - personaje.altura;

            let porcentajeAltura = anchuraImagenInicial / alturaImagenInicial;

            PropCanvas.posicionHorizontal = PropCanvas.posicionHorizontal || 0;

            let tiempo = 70;
            let xInicial = 0;
            let tamanioMinimoImagen = 60;
            let tamanioMaximoImagen = 500;
            PropCanvas.intervalo = setInterval(() => {
              

                contexto.beginPath();
                contexto.fillStyle = "#eee";
                contexto.fillRect(0, 0, anchura, altura);

                let variacionHorizontal = 20;
                // console.log( "variacionHorizontal: ", variacionHorizontal );

                //posicionHorizontal += variacionHorizontal;
                if (PropCanvas.posicionHorizontal > anchura) {
                    PropCanvas.posicionHorizontal = -personaje.anchura;
                }

                //dibujar el piso
                contexto.beginPath();
                contexto.fillStyle = "gray";
                contexto.fillRect(0, altura - 20, anchura, 20);

                //dibujar lineas verticales para hacer mas realista el movimiento
                let variacion = personaje.anchura;
                for (let x = anchura - xInicial; x > -variacion; x -= variacion) {
                    contexto.beginPath();
                    contexto.strokeStyle = "black";
                    contexto.moveTo(x, 0);
                    contexto.lineTo(x, altura - 20);
                    contexto.stroke();

                    contexto.beginPath();
                    contexto.strokeStyle = "white";
                    contexto.moveTo(x, altura - 20);
                    contexto.lineTo(x + 40, altura);
                    contexto.stroke();

                    contexto.beginPath();
                    contexto.strokeStyle = "white";
                    contexto.moveTo(x + variacion / 2, altura - 20);
                    contexto.lineTo(x + variacion / 2 + 40, altura);
                    contexto.stroke();
                }

                xInicial += variacionHorizontal;
                if (xInicial > variacion) {
                    xInicial = 0;
                }

              
                let posicionVertical = altura - personaje.altura;

                contexto.strokeStyle = "black";

                //dibujar lineas linea horizontales desde encima de la imagen para hacer aun mas realista el movimiento
                for (let y = posicionVertical; y > 0; y -= altura - posicionVertical) {
                    contexto.beginPath();
                    contexto.moveTo(0, y);
                    contexto.lineTo(anchura, y);
                    contexto.stroke();
                   
                }

                if (estaSaltando) {
                    imagenActual = 7;
                }
                else {
                    imagenActual += 2
                    if (imagenActual > 8) {
                        imagenActual = 1;
                    }
                }

                   
                //dibujar la imagen del gato
              
                if (estaSaltando) {
                 
                  
                    cantidadASaltar += (estaSubiendo ? 60 : -60);
                   
                    if (cantidadASaltar > maximoASaltar) {
                        cantidadASaltar = maximoASaltar;
                        estaSubiendo = false;
                      
                    }
                
                    if (estaSubiendo) {
                      
                       
                        personaje.y -= 20;
                       

                    } else {
                      
                        personaje.y += 20;
                        if(personaje.y > altura - personaje.altura)
                        {
                            personaje.y = altura - personaje.altura;
                        }
                        if (cantidadASaltar <= 0) {
                            estaSaltando = false;
                            contidadASaltar = 0;
                           
                            
                        }
                    }
                }

               
                personaje.imagen = document.getElementById(`gato${cantidadASaltar == maximoASaltar ? 2 : imagenActual}`);

               

                contexto.drawImage(personaje.imagen, personaje.x, personaje.y, personaje.anchura, personaje.altura);

                contexto.strokeStyle = "red";
                contexto.strokeRect( personaje.x, personaje.y, personaje.anchura, personaje.altura);

                for (let i = 0; i < obstaculos.length; i++) {
                    const obstaculo = obstaculos[i];
                    obstaculo.dibujar(contexto);
                    obstaculo.x -= variacionHorizontal;
                   

                    if (personaje.chocaCon(obstaculo)) {
                        console.log("Choca");
                    
                        // const music = new Audio('./audio/marioWoo.mp3');
                        // music.play();
                        // music.pause();
                        

                }
            }
                if (personaje.anchura < tamanioMinimoImagen || personaje.altura < tamanioMinimoImagen) {
                    estaCreciendo = true;
                }

                if (personaje.anchura > tamanioMaximoImagen || personaje.altura > tamanioMaximoImagen) {
                    estaCreciendo = false;
                }

               
            }, tiempo);


                
                        
        }


        miCanvas.addEventListener("click", () => {
            if (PropCanvas.estaPausado) {
                dibujarImagen();
            }
            else {
                clearInterval(PropCanvas.intervalo);
            }

            PropCanvas.estaPausado = !PropCanvas.estaPausado;
        });

        document.addEventListener("keypress", function () {
            if (!estaSaltando) {
                estaSaltando = true;
                estaSubiendo = true;
                
                
            }
        });


</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.1/howler.min.js"></script>

</body>

</html>